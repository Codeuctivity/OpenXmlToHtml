using OpenXmlPowerTools;
using OpenXmlPowerTools.OpenXMLWordprocessingMLToHtmlConverter;
using System.Collections.Generic;
using System.Xml.Linq;

namespace Codeuctivity.OpenXmlToHtml
{
    /// <summary>
    /// Handler that transforms every symbol into some HTML encoded font specific char
    /// </summary>
    public class SymbolHandler : ISymbolHandler
    {
        private OpenXmlPowerTools.OpenXMLWordprocessingMLToHtmlConverter.SymbolHandler DefaultSymbolHandler { get; set; }

        /// <summary>
        /// Dictionary codes from symbol char to Unicode
        /// </summary>
        public static Dictionary<string, string> SymbolCharDictonary => new Dictionary<string, string>
    {
            {"F020"," "},
            {"F021","!"},
            {"F022","∀"},
            {"F023","#"},
            {"F024","∃"},
            {"F025","%"},
            {"F026","&"},
            {"F027","∋"},
            {"F028","("},
            {"F029",")"},
            {"F02A","*"},
            {"F02B","+"},
            {"F02C",","},
            {"F02D","-"},
            {"F02E","."},
            {"F02F","/"},
            {"F030","0"},
            {"F031","1"},
            {"F032","2"},
            {"F033","3"},
            {"F034","4"},
            {"F035","5"},
            {"F036","6"},
            {"F037","7"},
            {"F038","8"},
            {"F039","9"},
            {"F03A",":"},
            {"F03B",";"},
            {"F03C","<"},
            {"F03D","="},
            {"F03E",">"},
            {"F03F","?"},
            {"F040","≅"},
            {"F041","A"},
            {"F042","B"},
            {"F043","X"},
            {"F044","Δ"},
            {"F045","E"},
            {"F046","Φ"},
            {"F047","Γ"},
            {"F048","H"},
            {"F049","I"},
            {"F04A","ϑ"},
            {"F04B","K"},
            {"F04C","∧"},
            {"F04D","M"},
            {"F04E","N"},
            {"F04F","O"},
            {"F050","Π"},
            {"F051","Θ"},
            {"F052","P"},
            {"F053","∑"},
            {"F054","T"},
            {"F055","Y"},
            {"F056","Z"},
            {"F057","Ω"},
            {"F058","Ξ"},
            {"F059","Ψ"},
            {"F05A","Z"},
            {"F05B","["},
            {"F05C","∴"},
            {"F05D","]"},
            {"F05E","⊥"},
            {"F05F","_"},
            // Not sure, but I think that overline has a context specific effect on the following char
            {"F060","\u0305"},
            {"F061","α"},
            {"F062","β"},
            {"F063","χ"},
            {"F064","δ"},
            {"F065","ε"},
            {"F066","ϕ"},
            {"F067","γ"},
            {"F068","η"},
            {"F069","ι"},
            {"F06A","φ"},
            {"F06B","κ"},
            {"F06C","λ"},
            {"F06D","μ"},
            {"F06E","ν"},
            {"F06F","ο"},
            {"F070","π"},
            {"F071","θ"},
            {"F072","ρ"},
            {"F073","σ"},
            {"F074","τ"},
            {"F075","υ"},
            {"F076","ϖ"},
            {"F077","ω"},
            {"F078","ξ"},
            {"F079","ψ"},
            {"F07A","ζ"},
            {"F07B","{"},
            {"F07C","|"},
            {"F07D","}"},
            {"F07E","∼"},
            {"F07F","□"},
            {"F080","□"},
            {"F081","□"},
            {"F082","□"},
            {"F083","□"},
            {"F084","□"},
            {"F085","□"},
            {"F086","□"},
            {"F087","□"},
            {"F088","□"},
            {"F089","□"},
            {"F08A","□"},
            {"F08B","□"},
            {"F08C","□"},
            {"F08D","□"},
            {"F08E","□"},
            {"F08F","□"},
            {"F090","□"},
            {"F091","□"},
            {"F092","□"},
            {"F093","□"},
            {"F094","□"},
            {"F095","□"},
            {"F096","□"},
            {"F097","□"},
            {"F098","□"},
            {"F099","□"},
            {"F09A","□"},
            {"F09B","□"},
            {"F09C","□"},
            {"F09D","□"},
            {"F09E","□"},
            {"F09F","□"},
            {"F0A0","□"},
            {"F0A1","ϒ"},
            {"F0A2","′"},
            {"F0A3","≤"},
            {"F0A4","∞"},
            {"F0A5","⁄"},
            {"F0A6","ƒ"},
            {"F0A7","♣"},
            {"F0A8","♦"},
            {"F0A9","♥"},
            {"F0AA","♠"},
            {"F0AB","↔"},
            {"F0AC","←"},
            {"F0AD","↑"},
            {"F0AE","→"},
            {"F0AF","↓"},
            {"F0B0","°"},
            {"F0B1","±"},
            {"F0B2","″"},
            {"F0B3","≥"},
            {"F0B4","×"},
            {"F0B5","∝"},
            {"F0B6","∂"},
            {"F0B7","•"},
            {"F0B8","÷"},
            {"F0B9","≠"},
            {"F0BA","≡"},
            {"F0BB","≈"},
            {"F0BC","…"},
            {"F0BD","⏐"},
            {"F0BE","⎯"},
            {"F0BF","↵"},
            {"F0C0","ℵ"},
            {"F0C1","ℑ"},
            {"F0C2","ℜ"},
            {"F0C3","℘"},
            {"F0C4","⊗"},
            {"F0C5","⊕"},
            {"F0C6","∅"},
            {"F0C7","∩"},
            {"F0C8","∪"},
            {"F0C9","⊃"},
            {"F0CA","⊇"},
            {"F0CB","⊄"},
            {"F0CC","⊂"},
            {"F0CD","⊆"},
            {"F0CE","∈"},
            {"F0CF","∉"},
            {"F0D0","∠"},
            {"F0D1","∇"},
            {"F0D2","®️"},
            {"F0D3","©️"},
            {"F0D4","™️"},
            {"F0D5","∏"},
            {"F0D6","√"},
            {"F0D7","⋅"},
            {"F0D8","¬"},
            {"F0D9","∧"},
            {"F0DA","∨"},
            {"F0DB","⇔"},
            {"F0DC","⇐"},
            {"F0DD","⇑"},
            {"F0DE","⇒"},
            {"F0DF","⇓"},
            {"F0E0","◊"},
            {"F0E1","⟨"},
            {"F0E2","®"},
            {"F0E3","©"},
            {"F0E4","™"},
            {"F0E5","∑"},
            {"F0E6","⎛"},
            {"F0E7","⎜"},
            {"F0E8","⎝"},
            {"F0E9","⎡"},
            {"F0EA","⎢"},
            {"F0EB","⎣"},
            {"F0EC","⎧"},
            {"F0ED","⎨"},
            {"F0EE","⎩"},
            {"F0EF","⎪"},
            {"F0F0","□"},
            {"F0F1","〉"},
            {"F0F2","∫"},
            {"F0F3","⌠"},
            {"F0F4","⎮"},
            {"F0F5","⌡"},
            {"F0F6","⎞"},
            {"F0F7","⎟"},
            {"F0F8","⎠"},
            {"F0F9","⎤"},
            {"F0FA","⎥"},
            {"F0FB","⎦"},
            {"F0FC","⎫"},
            {"F0FD","⎬"},
            {"F0FE","⎭"},
            {"F0FF","□"}
    };

        /// <summary>
        /// Dictonary codes from wingdings char to unicode
        /// </summary>
        public static Dictionary<string, string> WingdingsCharDictonary => new Dictionary<string, string>
    {
            {"F020"," "},
            {"F021","🖉"},
            {"F022","✂"},
            {"F023","✁"},
            {"F024","👓"},
            {"F025","🕭"},
            {"F026","🕮"},
            {"F027","🕯"},
            {"F028","🕿"},
            {"F029","✆"},
            {"F02A","🖂"},
            {"F02B","🖃"},
            {"F02C","📪"},
            {"F02D","📫"},
            {"F02E","📬"},
            {"F02F","📭"},
            {"F030","🗀"},
            {"F031","🗁"},
            {"F032","🖹"},
            {"F033","🗏"},
            {"F034","🗐"},
            {"F035","🗄"},
            {"F036","⌛"},
            {"F037","🖮"},
            {"F038","🖰"},
            {"F039","🖲"},
            {"F03A","🖳"},
            {"F03B","🖴"},
            {"F03C","🖫"},
            {"F03D","🖬"},
            {"F03E","✇"},
            {"F03F","✍"},
            {"F040","🖎"},
            {"F041","✌"},
            {"F042","👌"},
            {"F043","👍"},
            {"F044","👎"},
            {"F045","☜"},
            {"F046","☞"},
            {"F047","☝"},
            {"F048","☟"},
            {"F049","🖐"},
            {"F04A","☺"},
            {"F04B","😐"},
            {"F04C","☹"},
            {"F04D","💣"},
            {"F04E","☠"},
            {"F04F","🏳"},
            {"F050","🏱"},
            {"F051","✈"},
            {"F052","☼"},
            {"F053","💧"},
            {"F054","❄"},
            {"F055","🕆"},
            {"F056","✞"},
            {"F057","🕈"},
            {"F058","✠"},
            {"F059","✡"},
            {"F05A","☪"},
            {"F05B","☯"},
            {"F05C","ॐ"},
            {"F05D","☸"},
            {"F05E","♈"},
            {"F05F","♉"},
            {"F060","♊"},
            {"F061","♋"},
            {"F062","♌"},
            {"F063","♍"},
            {"F064","♎"},
            {"F065","♏"},
            {"F066","♐"},
            {"F067","♑"},
            {"F068","♒"},
            {"F069","♓"},
            {"F06A","🙰"},
            {"F06B","🙵"},
            {"F06C","●"},
            {"F06D","🔾"},
            {"F06E","■"},
            {"F06F","□"},
            {"F070","🞐"},
            {"F071","❑"},
            {"F072","❒"},
            {"F073","⬧"},
            {"F074","⧫"},
            {"F075","◆"},
            {"F076","❖"},
            {"F077","⬥"},
            {"F078","⌧"},
            {"F079","⮹"},
            {"F07A","⌘"},
            {"F07B","🏵"},
            {"F07C","🏶"},
            {"F07D","🙶"},
            {"F07E","🙷"},
            {"F07F","□"},
            {"F080","⓪"},
            {"F081","①"},
            {"F082","②"},
            {"F083","③"},
            {"F084","④"},
            {"F085","⑤"},
            {"F086","⑥"},
            {"F087","⑦"},
            {"F088","⑧"},
            {"F089","⑨"},
            {"F08A","⑩"},
            {"F08B","⓿"},
            {"F08C","❶"},
            {"F08D","❷"},
            {"F08E","❸"},
            {"F08F","❹"},
            {"F090","❺"},
            {"F091","❻"},
            {"F092","❼"},
            {"F093","❽"},
            {"F094","❾"},
            {"F095","❿"},
            {"F096","🙢"},
            {"F097","🙠"},
            {"F098","🙡"},
            {"F099","🙣"},
            {"F09A","🙞"},
            {"F09B","🙜"},
            {"F09C","🙝"},
            {"F09D","🙟"},
            {"F09E","·"},
            {"F09f","•"},
            {"F0A0","▪"},
            {"F0A1","⚪"},
            {"F0A2","🞆"},
            {"F0A3","🞈"},
            {"F0A4","◉"},
            {"F0A5","◎"},
            {"F0A6","🔿"},
            {"F0A7","▪"},
            {"F0A8","◻"},
            {"F0A9","🟂"},
            {"F0AA","✦"},
            {"F0AB","★"},
            {"F0AC","✶"},
            {"F0AD","✴"},
            {"F0AE","✹"},
            {"F0AF","✵"},
            {"F0B0","⯐"},
            {"F0B1","⌖"},
            {"F0B2","⟡"},
            {"F0B3","⌑"},
            {"F0B4","⯑"},
            {"F0B5","✪"},
            {"F0B6","✰"},
            {"F0B7","🕐"},
            {"F0B8","🕑"},
            {"F0B9","🕒"},
            {"F0BA","🕓"},
            {"F0BB","🕔"},
            {"F0BC","🕕"},
            {"F0BD","🕖"},
            {"F0BE","🕗"},
            {"F0BF","🕘"},
            {"F0C0","🕙"},
            {"F0C1","🕚"},
            {"F0C2","🕛"},
            {"F0C3","⮰"},
            {"F0C4","⮱"},
            {"F0C5","⮲"},
            {"F0C6","⮳"},
            {"F0C7","⮴"},
            {"F0C8","⮵"},
            {"F0C9","⮶"},
            {"F0CA","⮷"},
            {"F0CB","🙪"},
            {"F0CC","🙫"},
            {"F0CD","🙕"},
            {"F0CE","🙔"},
            {"F0CF","🙗"},
            {"F0D0","🙖"},
            {"F0D1","🙐"},
            {"F0D2","🙑"},
            {"F0D3","🙒"},
            {"F0D4","🙓"},
            {"F0D5","⌫"},
            {"F0D6","⌦"},
            {"F0D7","⮘"},
            {"F0D8","⮚"},
            {"F0D9","⮙"},
            {"F0DA","⮛"},
            {"F0DB","⮈"},
            {"F0DC","⮊"},
            {"F0DD","⮉"},
            {"F0DE","⮋"},
            {"F0DF","🡨"},
            {"F0E0","🡪"},
            {"F0E1","🡩"},
            {"F0E2","🡫"},
            {"F0E3","🡬"},
            {"F0E4","🡭"},
            {"F0E5","🡯"},
            {"F0E6","🡯"},
            {"F0E7","🡮"},
            {"F0E8","🡸"},
            {"F0E9","🡺"},
            {"F0EA","🡹"},
            {"F0EB","🡻"},
            {"F0EC","🡼"},
            {"F0ED","🡽"},
            {"F0EE","🡿"},
            {"F0EF","🡾"},
            {"F0F0","⇦"},
            {"F0F1","⇨"},
            {"F0F2","⇧"},
            {"F0F3","⇩"},
            {"F0F4","⬄"},
            {"F0F5","⇳"},
            {"F0F6","⬁"},
            {"F0F7","⬃"},
            {"F0F8","⬂"},
            {"F0F9","🢬"},
            {"F0FA","🢭"},
            {"F0FB","🗶"},
            {"F0FC","✔"},
            {"F0FD","🗷"},
            {"F0FE","🗹"},
    };

        /// <summary>
        /// Default ctor
        /// </summary>
        public SymbolHandler()
        {
            DefaultSymbolHandler = new OpenXmlPowerTools.OpenXMLWordprocessingMLToHtmlConverter.SymbolHandler();
        }

        /// <summary>
        /// Default handler that transforms every symbol into some html encoded font specific char
        /// </summary>
        /// <param name="element"></param>
        /// <param name="fontFamily"></param>
        /// <returns></returns>
        public XElement TransformSymbol(XElement element, Dictionary<string, string> fontFamily)
        {
            if (fontFamily.TryGetValue("font-family", out var currentSymbolFontFamily) && currentSymbolFontFamily == "Symbol")
            {
                var customChar = element.Attribute(W._char)?.Value;

                if (customChar != null && SymbolCharDictonary.TryGetValue(customChar, out var commonChar))
                {
                    return new XElement(Xhtml.span, commonChar);
                }
            }
            else if (fontFamily.TryGetValue("font-family", out var currentWingdingsFontFamily) && currentWingdingsFontFamily == "Wingdings")
            {
                var customChar = element.Attribute(W._char)?.Value;

                if (customChar != null && WingdingsCharDictonary.TryGetValue(customChar, out var commonChar))
                {
                    return new XElement(Xhtml.span, commonChar);
                }
            }

            return DefaultSymbolHandler.TransformSymbol(element, fontFamily);
        }
    }
}